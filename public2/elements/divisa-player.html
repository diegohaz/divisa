<dom-module id="divisa-player">

  <style>
    :host {
      position: absolute;
      bottom: 0;
      -webkit-transform-origin: 50% 100%;
      transform-origin: 50% 100%;
      z-index: 1000;
    }

    @-webkit-keyframes playerMoving {
      0% { background-position: 0 0; }
      100% { background-position: 120% 0; }
    }

    @-moz-keyframes playerMoving {
      0% { background-position: 0 0; }
      100% { background-position: 120% 0; }
    }

    #reflection {
      position: absolute;
      width: 190%;
      bottom: 100%;
      background-color: #aaa;
      border-radius: .5vw;
      margin: 0 -50% 1vw;
      padding: 1vw;
      text-align: center;
      transition: opacity 200ms;
      transform-origin: 50% 100%;
      -webkit-transform-origin: 50% 100%;
    }

    #player {
      background-size: 600% 303%;
      background-position: 0 100%;
      width: 15vw;
      height: 30vw;
      -webkit-transform-origin: 50% 100%;
      transform-origin: 50% 100%;
    }

    #player[moving] {
      -webkit-animation: playerMoving 1s steps(6) infinite;
      -moz-animation: playerMoving 1s steps(6) infinite;
    }
  </style>

  <template>
    <div id="reflection">reflectiondsakda dsadask djksa jdklsaskdsajdja lkda jldka dsaj dlksaj djaslk djal ka</div>
    <div id="player" moving$="{{moving}}"></div>
  </template>

</dom-module>

<script>
Polymer({
  is: 'divisa-player',

  maxPosition: 0,

  properties: {
    steps: { value: 5 },
    scale: { value: 1, observer: '_scaleChanged' },
    position: { value: 0, observer: '_positionChanged' },
    direction: { value: 1, observer: '_directionChanged' },
    moving: { value: false, notify: true },
    src: String,
    reflections: Array
  },

  ready: function() {
    this.$.player.style.backgroundImage = 'url(' + this.src + ')';
  },

  attached: function() {
    this.async(function() {
      this.position = -this.getWidthDiff();
    }, 1);
  },

  move: function(direction) {
    this.direction = direction || this.direction;
    this.position += this.steps * this.scale * this.direction;
  },

  reflect: function(id) {

  },

  getWidth: function() {
    return this.offsetWidth * this.scale;
  },

  getWidthDiff: function() {
    return (this.offsetWidth - this.getWidth())/2;
  },

  _positionChanged: function(pos) {
    this.style.left = pos + 'px';
    this.maxPosition = pos + this.getWidth() + this.getWidthDiff();
  },

  _scaleChanged: function(scale) {
    this.style.webkitTransform = 'scale(' + scale + ')';
    this.style.transform = 'scale(' + scale + ')';
    this.$.reflection.style.webkitTransform = 'scale(' + 1/scale + ')';
    this.$.reflection.style.transform = 'scale(' + 1/scale + ')';
  },

  _directionChanged: function(dir) {
    this.$.player.style.webkitTransform = 'scaleX(' + dir + ')';
    this.$.player.style.transform = 'scaleX(' + dir + ')';
  }
});
</script>